"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[71882],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),u=r,h=d["".concat(o,".").concat(u)]||d[u]||m[u]||i;return a?n.createElement(h,l(l({ref:t},c),{},{components:a})):n.createElement(h,l({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[d]="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},12:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>w,contentTitle:()=>f,default:()=>N,frontMatter:()=>h,metadata:()=>k,toc:()=>g});var n=a(3905),r=Object.defineProperty,i=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,c=(e,t,a)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,d=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&c(e,a,t[a]);if(s)for(var a of s(t))p.call(t,a)&&c(e,a,t[a]);return e},m=(e,t)=>i(e,l(t)),u=(e,t)=>{var a={};for(var n in e)o.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&s)for(var n of s(e))t.indexOf(n)<0&&p.call(e,n)&&(a[n]=e[n]);return a};const h={title:"A First Look at ES|QL",authors:"mavam",date:new Date("2023-08-29T00:00:00.000Z"),last_update:new Date("2023-12-12T00:00:00.000Z"),tags:["esql","elastic","tql","kusto","splunk","spl","pipelines","language"],comments:!0},f=void 0,k={permalink:"/blog/a-first-look-at-esql",source:"@site/blog/a-first-look-at-esql/index.md",title:"A First Look at ES|QL",description:"Elastic just released their new pipeline query language called",date:"2023-08-29T00:00:00.000Z",formattedDate:"August 29, 2023",tags:[{label:"esql",permalink:"/blog/tags/esql"},{label:"elastic",permalink:"/blog/tags/elastic"},{label:"tql",permalink:"/blog/tags/tql"},{label:"kusto",permalink:"/blog/tags/kusto"},{label:"splunk",permalink:"/blog/tags/splunk"},{label:"spl",permalink:"/blog/tags/spl"},{label:"pipelines",permalink:"/blog/tags/pipelines"},{label:"language",permalink:"/blog/tags/language"}],readingTime:7.35,hasTruncateMarker:!0,authors:[{name:"Matthias Vallentin",title:"Founder & CEO",url:"https://github.com/mavam",email:"matthias@tenzir.com",imageURL:"https://github.com/mavam.png",key:"mavam"}],frontMatter:{title:"A First Look at ES|QL",authors:"mavam",date:"2023-08-29T00:00:00.000Z",last_update:"2023-12-12T00:00:00.000Z",tags:["esql","elastic","tql","kusto","splunk","spl","pipelines","language"],comments:!0},prevItem:{title:"Tenzir v4.1",permalink:"/blog/tenzir-v4.1"},nextItem:{title:"Slash Your SIEM, Cloud, and Data Costs with Tenzir Security Data Pipelines",permalink:"/blog/slash-your-siem-cloud-and-data-costs-with-tenzir-security-data-pipelines"}},w={authorsImageUrls:[void 0]},g=[{value:"Walk-through by Example",id:"walk-through-by-example",level:2},{value:"Sources, Transformations, ... but Sinks?",id:"sources-transformations--but-sinks",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Engine",id:"engine",level:2},{value:"Data Model",id:"data-model",level:2},{value:"Summary",id:"summary",level:2}],x={toc:g},M="wrapper";function N(e){var t=e,{components:a}=t,r=u(t,["components"]);return(0,n.kt)(M,m(d(d({},x),r),{components:a,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Elastic ",(0,n.kt)("a",d({parentName:"p"},{href:"https://www.elastic.co/blog/elasticsearch-query-language-esql"}),"just released")," their new pipeline query language called\n",(0,n.kt)("strong",{parentName:"p"},"ES|QL"),". This is a conscious attempt to consolidate the language zoo in the\nElastic ecosystem\n(",(0,n.kt)("a",d({parentName:"p"},{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html"}),"queryDSL"),",\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/eql.html"}),"EQL"),",\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://www.elastic.co/guide/en/kibana/current/kuery-query.html"}),"KQL"),",\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/xpack-sql.html"}),"SQL"),",\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-painless.html"}),"Painless"),",\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://www.elastic.co/guide/en/kibana/current/timelion.html"}),"Canvas/Timelion"),").\nElastic said that they worked on this effort for over a year. The\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql.html"}),"documentation")," is still sparse, but we still tried to read between\nthe lines to understand what this new pipeline language has to offer."),(0,n.kt)("p",null,(0,n.kt)("figure",d({parentName:"p"},{className:"markdown-inline-svg"}),"\n  ",(0,n.kt)("svg",d({parentName:"figure"},{viewBox:"0 0 782.47 334.465",role:"img","aria-hidden":"true"}),"eyJ2ZXJzaW9uIjoiMSIsImVuY29kaW5nIjoiYnN0cmluZyIsImNvbXByZXNzZWQiOnRydWUsImVuY29kZWQiOiJ4nO1aW3PayFx1MDAxMn73r3Cxr4ky98u+2WBcdTAwMWLbiSGBdVx1MDAxY5/acslCgIyQiCQwTjb//bRkXHUwMDFiXHRxMWAgbDZylVx1MDAwYvXMqEc9/c3X3aPve/v7heihZ1x1MDAxN/7cL9hDy3SdRmDeXHUwMDE33sTygVx1MDAxZISO70FcdTAwMTNJ7kO/XHUwMDFmWEnPdlx1MDAxNPXCP9+9M3s9I1x1MDAxZGVYfvdxpO3aXduLQuj7P7jf3/+e/M/oiuxhlPRNpKkmTfPCXHUwMDBi30uUaqU5XCKEsVFcdTAwMDcnLIGiyG5Aa9N0QzttiUVcdTAwMDXr+KRuuWU0aJ66XHUwMDE3XHUwMDAzt2Kx/nE9Vdp0XFy3XHUwMDE2PbiPb2Ra7X5gp61hXHUwMDE0+Fx1MDAxZPuz04jaz1x1MDAwNsjIR+NcdTAwMWFm2IZcdIyaXHUwMDAzv99qe3ZcdTAwMTi/Olx1MDAxYUn9nmk50Vx1MDAwM8gwSqWm10pcdTAwMWWSSoaxKpXexyOIQDnlRd/1g1j5XHUwMDFm2I7/Uu23ptVpwVx1MDAxNLzGqE9cdTAwMTSYXtgzXHUwMDAzWI603/3Ta2GiXGastVZYKM04xel7tm2n1Y6SPjzVbyfGxlx1MDAxNFx1MDAwYiQ5yqxFrLV32khW/O/UxIHZtU/jIV7fdbNG8lx1MDAxYU9GXHUwMDFha7iNXHUwMDFijjLOkz6q32uYj0uNhSZcdTAwMTJRmLFcImLU7jpeJ/8417c6U7yj6XtRzflm55YjXHUwMDE2XHUwMDFmm13HTdZpJE48XHUwMDE1XGZ5VCuMyVx1MDAwZVxcp+Ulblx1MDAwNpO1gzFnjlx1MDAxY8DEqEPk99JWXHUwMDBitJiOZ1x1MDAwN5Nm8Vx1MDAwM6fleKZbn6JcdTAwMTFezy6PlsTIrMmtXHUwMDE52nEryJVKhD/eLIc5jFhe+lxmOszBylJQpVx1MDAxNkbdgV+6e7Bub0rlsONdXHUwMDBlr6tHXHUwMDFl/2vnUccyXHUwMDE2fVx0dU3aoFS+XHUwMDAydcKQMeik1ERcdTAwMGIlU83zQKc0YohKlq7Er4+5f7Zccrl/toQ4jPPSZ8RcdTAwMTHwXGYtuEx9/yXAXHJvmpVuUK25Z6dnJ5Wreuns5sHbfcCJLdJcdTAwMWNFXHUwMDA2je1KlVx1MDAxNkwxmmJoLuJgY1Tw91x1MDAxZlx1MDAwMtzH99tGXFxW4yYhx1x1MDAxNclLnyHHJIJ4hpHUSi9BLrgptVx1MDAwNt7VtVuvfzk8872K/Ov8fOchRzUxXHUwMDE0QVx1MDAxNOe4XHUwMDBlXHUwMDBiXHUwMDAyUSBmSGQxsPZQU1x1MDAxYVx1MDAxNHNNKSGSU41Sr1x1MDAxZWGQTkBQaEklxPybxuBY41x1MDAwNFxupaaYyVeikKgx6Vx1MDAxY1x1MDAxMH7t28FDqbZ1KE7qXVxikIRPXHUwMDA15CNSbFLu4MrFfcnpXGbDoFY+Lt5XrzMv9oTa5FHj/MCEQVx1MDAwNSUq761cdTAwMDQjQyDOxlx1MDAwMqeRl3GDTounODVYzsEnMZJ3ectusIY51+X/UELZWqxcdTAwMTn6oVx1MDAwZlx09XTkp94yXHUwMDFk+euBx3Oeh1x0ZN1Eion8IDYp53lpmjVgyCUpWyhXX1x1MDAwZYqKUIVI1kFcdTAwMTeFYs93slx1MDAxNYn4Sn/tp26Q3Ix+//1mau+3445cdTAwMTZfqYulg/dyXHUwMDBmKbhmXHUwMDE4XHUwMDE1/W7XieCtqvGMJkxcdTAwMWaZQXToeFxyx2vl22yvMaMlXHUwMDE5dVx1MDAxMFx1MDAwNP592zYn1lx1MDAxOcbl21biUKZnh62YMy6RWIJDrft+0VKVO8SPdPfzYfeudfx+5zlcdTAwMTQjWHhcdTAwMDGeiFx1MDAxOcRcZpiLVHfyXHUwMDAwzVxygSXO7k3rZlJcdTAwMGUzUFRLgoWckT5OXHUwMDEyKYXwhinyU5NHLVx1MDAwNU2tuWlcdTAwMTY92n4se7R0MDuXO6lt0Wt57jlhr1x1MDAxMn267pBvXHUwMDE1dbFcYndiKVxyjuJcdTAwMTgrz51EXHUwMDE4XGJSXG5Gp3CnUFx1MDAwNlZcdTAwMTRcIrRpXHUwMDFlXHUwMDA1bEykpGNcdTAwMDN/M+jLXGbKXHUwMDE1JVpcYqGy3va0nVIp89JRsVx1MDAxYkJlMMz6+Vx1MDAxMzYurFdKKNfKn1N8Lb4yXvbLkiiXM484sFx1MDAwNMBSwtHi1Valq93B1zNyUVx1MDAxYVx1MDAwNiX7pIPOW+Xdr7ZCUmdQKjiVwKdaZCpcdTAwMWPJLoWYoaTAYFx1MDAwN1xuQWRmy187lVJDSJhcdTAwMDCjPJdQzKFSSJWFQlx1MDAxY22cTF9AMoH4I53Cpun0fPt0er4uOp3OlCkkRcZh85DUVDPYM8nix45XzauK2S5eXt1/lYHfZe/PO3rdx46v4LdcdTAwMTmIJNRQXHUwMDFjgkQhVVx1MDAxY6nlwlx1MDAwNmhEYFxuXHUwMDAyiJxcdTAwMGLIVVxif5S7Y8j4lVx1MDAxOFx1MDAwZp7TXGaeXHUwMDE5SKpph5Fac1wiXHT6ySWi2E1WyktX46pcdTAwMDU5cFx1MDAxOTbbXGbTv522rPE1WtBJpl+JVyGymVxyYqJcdMdULFx1MDAwZeJq66J0eV1cdTAwMWOSPmuV7mr9ty3ywdp5Xlx1MDAwNZBcdTAwMWFcdTAwMDBcdTAwMDZIszhcdTAwMDfjXG49XHUwMDA2Y4aRXHUwMDAxXHUwMDExXHUwMDA2iPlcdTAwMGIwXlx1MDAwM69yXHUwMDFh86pcdTAwMTY8qTgvwqtcdTAwMDQ4lWKcPVx1MDAxONp+klxuwSfW22PV2vZZtbYtVlV85olcdTAwMGLmYGai9OKHnGUzOij2qWX1blx1MDAxYlx1MDAxZtmJqLTfftQ7T6pSXHUwMDE5iFx1MDAxMCw5p1x1MDAxM6TKKDa0ppRCkLtBUoVMi6tcdTAwMTlJPbRcdTAwMTGMxtpGpCpcdTAwMTiXXHUwMDA0QoGfiEVcdTAwMTVXrFYqXHUwMDE4/fKcOrmqiTxd0LWR6sxcdTAwMTJcdTAwMDWmSCCl1Fx1MDAxMiXfIa87d2bXPGhcckW9XHUwMDExfji58b+1d55UNTFiS1x1MDAwM1x1MDAxYZTCWUQkKCbCIFx1MDAxNI0nj2s/O0XaYFJrXHUwMDA2oS6Oq8tTvl+YUvJVSFx1MDAxMMLXXtpaMjCWXHUwMDE4Z06KNk2oVWBBN570lll1Uu/r67+HzeZcdTAwMTeOjztccvNrp1o+6J+5qExcdTAwMTep/0I6ZPCJY34qRD6FenYwxWHfYONl4TTzgvidMDKWlv0u/b5Y+qVcdTAwMWEx2Fx1MDAxOaTIOttzwYHNKTgwSjSimVwi7dpqvytDcb3sNcXb4ivjZ5PstSxJ72jxXHUwMDE3vG3myiuuXHUwMDE44XSJL/9Is1x1MDAxZDjBhzD6cncxXGKOXHUwMDFhxc9XtrvzfEpcdTAwMTVk/lxuaSZhpbVcdTAwMTQ8x6hcZlx1MDAxYiDb4KdIXHUwMDA0x1x1MDAxYiHXmDCIzCGMSstcdTAwMDLz0lOFXHUwMDE5kCn5qdmpVlx1MDAxOKXHXHUwMDA3mybToulccszwXd3pXHUwMDAyX/netjl1pvrXU2s1uKn4g083Z43Lh9My+lx1MDAxNFxcRpgs+lnS+KF7Qq1cdTAwMTJcdTAwMTmYsXHOfXY3yPPYrO+84y/vJFx1MDAxZifl39z68rEq4kKKuOQ6ZY9VfOZcdTAwMDFcdTAwMWLFlGKNN8CtilxivdppzFq5ddLX4ivjZf9cdTAwMWVm3XuaW8Hs9WpcdTAwMTFYXHUwMDFiWlx1MDAxZlFcXFx1MDAxODj2/eFcdTAwMTSfbyZXYe9cdPWxz9uxZb//2Pvxf9J+rVx1MDAxNCJ9",(0,n.kt)("defs",{parentName:"svg"},(0,n.kt)("style",{parentName:"defs"},'@font-face{font-family:"Virgil";src:url(https://excalidraw.com/Virgil.woff2)}@font-face{font-family:"Cascadia";src:url(https://excalidraw.com/Cascadia.woff2)}')),(0,n.kt)("text",d({parentName:"svg"},{x:"64.1",fill:"#1e1e1e",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"100",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(197.406 107.809)"}),"ES"),(0,n.kt)("text",d({parentName:"svg"},{x:"8.4",fill:"#f3d337",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"100",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(342.406 107.809)"}),"|"),(0,n.kt)("text",d({parentName:"svg"},{x:"65.2",fill:"#1e1e1e",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"100",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(377.406 107.809)"}),"QL"),(0,n.kt)("text",d({parentName:"svg"},{x:"63.658",fill:"#1e1e1e",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"28",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(310.227 10)"}),"queryDSL"),(0,n.kt)("path",d({parentName:"svg"},{fill:"none",stroke:"#ced4da",strokeLineCap:"round",strokeWidth:"2",d:"M364.19 56.574c-7.37 19.03-9.85 35.32-17.74 54.51m18.2-52.05c-6.17 14.52-9.75 31.65-15.99 53.73"})),(0,n.kt)("text",d({parentName:"svg"},{x:"27.692",fill:"#1e1e1e",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"28",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(22.769 43.426)"}),"EQL"),(0,n.kt)("path",d({parentName:"svg"},{fill:"none",stroke:"#ced4da",strokeLineCap:"round",strokeWidth:"2",d:"M93.28 75.818c16.84 10.92 37.11 19.79 68.42 44.09m-66.66-45.1c14.44 10.48 30.33 20.54 69.03 46.28"})),(0,n.kt)("text",d({parentName:"svg"},{x:"26.838",fill:"#1e1e1e",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"28",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(654.743 52.685)"}),"KQL"),(0,n.kt)("path",d({parentName:"svg"},{fill:"none",stroke:"#ced4da",strokeLineCap:"round",strokeWidth:"2",d:"M642.07 72.6c-46.61 19.73-93.6 43.43-118.12 52.92M642.1 71.24c-33.36 14.58-65.72 29.83-116.89 53.79"})),(0,n.kt)("text",d({parentName:"svg"},{x:"26.768",fill:"#1e1e1e",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"28",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(718.934 258.571)"}),"SQL"),(0,n.kt)("path",d({parentName:"svg"},{fill:"none",stroke:"#ced4da",strokeLineCap:"round",strokeWidth:"2",d:"M696.108 281.482c-51.51-23.56-105.91-44.2-168.24-69.22m167.44 68.12c-54.34-23.03-108.24-46.68-169.46-68.47"})),(0,n.kt)("text",d({parentName:"svg"},{x:"54.74",fill:"#1e1e1e",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"28",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(10 274.04)"}),"Painless"),(0,n.kt)("path",d({parentName:"svg"},{fill:"none",stroke:"#ced4da",strokeLineCap:"round",strokeWidth:"2",d:"M188.137 212.677c-32.5 22.28-63.67 46.39-84.31 57.22m86.63-56.2c-24.65 15.1-51.15 33.26-84.91 56.45"})),(0,n.kt)("text",d({parentName:"svg"},{x:"108.038",fill:"#1e1e1e",dominantBaseline:"text-before-edge",fontFamily:"Virgil, Segoe UI Emoji",fontSize:"28",style:{whiteSpace:"pre"},textAnchor:"middle",transform:"translate(301.487 289.465)"}),"Canvas/Timelion"),(0,n.kt)("path",d({parentName:"svg"},{fill:"none",stroke:"#ced4da",strokeLineCap:"round",strokeWidth:"2",d:"M365.005 218.663c10.41 23.66 21.71 45.94 28.82 62.82m-28.76-64.02c10.45 21.75 21.06 45.51 30.05 62.09"}))))),(0,n.kt)("p",null,"The reason why we are excited about this announcement is because we have ",(0,n.kt)("em",{parentName:"p"},"also"),"\ndesigned and implemented a pipeline language over the past 8 months that we just\n",(0,n.kt)("a",d({parentName:"p"},{href:"/blog/introducing-tenzir-security-data-pipelines"}),"launched at BlackHat"),". First,\nwe see the release of ES|QL as a confirmation for pipeline model. In our ",(0,n.kt)("a",d({parentName:"p"},{href:"/blog/tenzir-for-splunk-users"}),"blog\npost about Splunk's Search Processing Language\n(SPL)"),", we briefly mentioned why SQL might not be\nthe best choice for analysts, and why thinking about one operator at a time\nprovides an easier user experience. Second, we'd like to look under the hood of\nES|QL to compare and reflect on our own ",(0,n.kt)("a",d({parentName:"p"},{href:"/language"}),"Tenzir Query Language\n(TQL)"),"."),(0,n.kt)("h2",d({},{id:"walk-through-by-example"}),"Walk-through by Example"),(0,n.kt)("p",null,"So, ES|QL, how does it feel?"),(0,n.kt)("pre",null,(0,n.kt)("code",d({parentName:"pre"},{}),'  FROM employees\n| EVAL hired_year = TO_INTEGER(DATE_FORMAT(hire_date, "YYYY"))\n| WHERE hired_year > 1984\n| STATS avg_salary = AVG(salary) BY languages\n| EVAL avg_salary = ROUND(avg_salary)\n| EVAL lang_code = TO_STRING(languages)\n| ENRICH languages_policy ON lang_code WITH lang = language_name\n| WHERE NOT IS_NULL(lang)\n| KEEP avg_salary, lang\n| SORT avg_salary ASC\n| LIMIT 3\n')),(0,n.kt)("p",null,"This syntax reads very straight-forward. Splunk users will immediately grasp\nwhat it does, as there is a remarkable similarity in operator naming. Let's go\nthrough each pipeline operator individually:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-from.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"FROM"))," generates a table with up to 10k rows from a data stream,\nindex, or alias. We asked ourselves why there is a hard-baked 10k limit?\nShouldn't that be the job of ",(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-limit.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"LIMIT")),"? The limit feels a\ntechnical limitation rather than a conscious design decision. In TQL, we have\nunbounded streams but also follow the single responsibility principle: one\noperator has exactly one job."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-eval.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"EVAL"))," appends new or replaces existing columns. We named this\noperator ",(0,n.kt)("a",d({parentName:"li"},{href:"/next/operators/extend"}),(0,n.kt)("inlineCode",{parentName:"a"},"extend")),' because we found the\nSplunk-inspired command name "eval" too generic for this use case.',(0,n.kt)("sup",d({parentName:"li"},{id:"fnref-1-7e9dca"}),(0,n.kt)("a",d({parentName:"sup"},{href:"#fn-1-7e9dca",className:"footnote-ref"}),"1"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-where.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"WHERE"))," filters the input with an expression. We have the same\n",(0,n.kt)("a",d({parentName:"li"},{href:"/next/operators/where"}),(0,n.kt)("inlineCode",{parentName:"a"},"where"))," in TQL."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-stats-by.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"STATS"))," groups its input via ",(0,n.kt)("inlineCode",{parentName:"li"},"BY")," and applies aggregation\nfunctions on select fields of each group.  Elastic went with Splunk\nnomenclature for this central operation, perhaps also to make the transition\nfrom Splunk to Elastic as easy as possible."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-enrich.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"ENRICH"))," adds data from existing indexes. It's effectively a\njoin operation, and the ",(0,n.kt)("inlineCode",{parentName:"li"},"ON"),' keywords makes it possible to select the join\nfield. Interestingly, the word "join" doesn\'t appear on the documentation. We\nhypothesize that this was a conscious choice, as a database join may feel\nintimidating for beginning and intermediate users.'),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-keep.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"KEEP"))," selects a set of columns from the input and drops all\nothers. It is the inverse of ",(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-drop.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"DROP")),". In TQL, we call these\nprojection operators ",(0,n.kt)("a",d({parentName:"li"},{href:"/next/operators/select"}),(0,n.kt)("inlineCode",{parentName:"a"},"select"))," and also\n",(0,n.kt)("a",d({parentName:"li"},{href:"/next/operators/drop"}),(0,n.kt)("inlineCode",{parentName:"a"},"drop")),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-sort.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"SORT")),"\nsorts rows by one or more fields. ",(0,n.kt)("inlineCode",{parentName:"li"},"SORT height DESC, first_name ASC")," sorts the\nfield ",(0,n.kt)("inlineCode",{parentName:"li"},"height")," in descending order and the field ",(0,n.kt)("inlineCode",{parentName:"li"},"first_name")," in ascending\norder. The syntax of our ",(0,n.kt)("a",d({parentName:"li"},{href:"/next/operators/sort"}),(0,n.kt)("inlineCode",{parentName:"a"},"sort"))," is identical.\nControlling the position of null values works with ",(0,n.kt)("inlineCode",{parentName:"li"},"NULLS FIRST")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"NULLS\nLAST"),". In TQL, we went Kusto-like with ",(0,n.kt)("inlineCode",{parentName:"li"},"nulls-first")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"nulls-last"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-limit.html"}),(0,n.kt)("inlineCode",{parentName:"a"},"LIMIT"))," restricts the number of output rows. In TQL, we have\n",(0,n.kt)("a",d({parentName:"li"},{href:"/next/operators/head"}),(0,n.kt)("inlineCode",{parentName:"a"},"head"))," and ",(0,n.kt)("a",d({parentName:"li"},{href:"/next/operators/tail"}),(0,n.kt)("inlineCode",{parentName:"a"},"tail"))," for this\npurpose.")),(0,n.kt)("h2",d({},{id:"sources-transformations--but-sinks"}),"Sources, Transformations, ... but Sinks?"),(0,n.kt)("p",null,"ES|QL differentiates two types of commands (which we call ",(0,n.kt)("em",{parentName:"p"},"operators")," in TQL):"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-source-commands.html"}),"Source commands")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-processing-commands.html"}),"Processing commands"))),(0,n.kt)("p",null,"In TQL, an operator is a ",(0,n.kt)("em",{parentName:"p"},"source"),", a ",(0,n.kt)("em",{parentName:"p"},"transformation"),", or a ",(0,n.kt)("em",{parentName:"p"},"sink"),". Some\noperators can be of multiple categories, like ",(0,n.kt)("a",d({parentName:"p"},{href:"/next/operators/shell"}),(0,n.kt)("inlineCode",{parentName:"a"},"shell")),"."),(0,n.kt)("p",null,"Maybe this is still coming, but ES|QL doesn't appear to offer sinks. We\nhypothesize that users should consume pipeline output uniformly as JSON through\na REST API."),(0,n.kt)("h2",d({},{id:"syntax"}),"Syntax"),(0,n.kt)("p",null,"Syntactically, the ",(0,n.kt)("a",d({parentName:"p"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-syntax.html"}),"ES|QL language")," is similar to TQL. The\nfollowing points stood out:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The ",(0,n.kt)("inlineCode",{parentName:"li"},"|")," (pipe) symbol separates commands that describe the dataflow."),(0,n.kt)("li",{parentName:"ul"},"Comments work as in C++: ",(0,n.kt)("inlineCode",{parentName:"li"},"//")," for single line and ",(0,n.kt)("inlineCode",{parentName:"li"},"/*")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"*/")," for multi-line\ncomments."),(0,n.kt)("li",{parentName:"ul"},"Expressions can occur in ",(0,n.kt)("inlineCode",{parentName:"li"},"WHERE"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"STATS"),", and other commands. The following\nrelational operators exist:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Arithmetic comparisons via ",(0,n.kt)("inlineCode",{parentName:"li"},"<"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"<="),", ",(0,n.kt)("inlineCode",{parentName:"li"},"=="),", ",(0,n.kt)("inlineCode",{parentName:"li"},">="),", ",(0,n.kt)("inlineCode",{parentName:"li"},">")),(0,n.kt)("li",{parentName:"ul"},"Set membership via ",(0,n.kt)("inlineCode",{parentName:"li"},"IN")),(0,n.kt)("li",{parentName:"ul"},"Glob-like wildcard search via ",(0,n.kt)("inlineCode",{parentName:"li"},"LIKE")),(0,n.kt)("li",{parentName:"ul"},"Regular expressions via ",(0,n.kt)("inlineCode",{parentName:"li"},"RLIKE")))),(0,n.kt)("li",{parentName:"ul"},"Date-time literals make it easier to express dates (",(0,n.kt)("inlineCode",{parentName:"li"},"seconds"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"hours"),", etc.)\nand timespans (e.g., ",(0,n.kt)("inlineCode",{parentName:"li"},"1 day"),"). We found that expressing numeric values across\nmultiple orders of magnitude is common, e.g., when dealing with GBs. This is\nwhy we also offer SI literals in TQL, allowing you to write large numbers as\n",(0,n.kt)("inlineCode",{parentName:"li"},"1 Mi")," or ",(0,n.kt)("inlineCode",{parentName:"li"},"1 M"),"."),(0,n.kt)("li",{parentName:"ul"},"ES|QL features multiple scalar ",(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-functions.html"}),"functions"),".\nthat perform value-to-value transformations. Functions can occur in ",(0,n.kt)("inlineCode",{parentName:"li"},"ROW"),",\n",(0,n.kt)("inlineCode",{parentName:"li"},"EVAL"),", and ",(0,n.kt)("inlineCode",{parentName:"li"},"WHERE"),"."),(0,n.kt)("li",{parentName:"ul"},"Similarly, ",(0,n.kt)("a",d({parentName:"li"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-agg-functions.html"}),"aggregation functions")," perform a vector-to-scalar\ntransformation per group in ",(0,n.kt)("inlineCode",{parentName:"li"},"STATS"),".")),(0,n.kt)("h2",d({},{id:"engine"}),"Engine"),(0,n.kt)("p",null,"ES|QL comes with its own executor, i.e., it's not transpiled into any of the\nexisting engines. A running pipelines is a ",(0,n.kt)("em",{parentName:"p"},"task")," and there exists an\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-task-management.html"}),"API")," for querying their state, which may return something like:"),(0,n.kt)("pre",null,(0,n.kt)("code",d({parentName:"pre"},{className:"language-json"}),'{\n  "node" : "2j8UKw1bRO283PMwDugNNg",\n  "id" : 5326,\n  "type" : "transport",\n  "action" : "indices:data/read/esql",\n  "description" : "FROM test | STATS MAX(d) by a, b",\n  "start_time" : "2023-07-31T15:46:32.328Z",\n  "start_time_in_millis" : 1690818392328,\n  "running_time" : "41.7ms",\n  "running_time_in_nanos" : 41770830,\n  "cancellable" : true,\n  "cancelled" : false,\n  "headers" : { }\n}\n')),(0,n.kt)("h2",d({},{id:"data-model"}),"Data Model"),(0,n.kt)("p",null,"The concept of ",(0,n.kt)("a",d({parentName:"p"},{href:"https://esql-latest.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-multivalued-fields.html"}),"multi-valued fields")," exists to bridge the world\nbetween JSON records and 2D tables. This shows the heritage of the type system,\nwhich evolved from document stores as opposed to structured data stores. In\ndocument land, every record may have a different shape (or schema). The term\n",(0,n.kt)("em",{parentName:"p"},"multi-valued")," effectively means ",(0,n.kt)("em",{parentName:"p"},"list"),", e.g., ",(0,n.kt)("inlineCode",{parentName:"p"},"[1, 2, 3]"),"."),(0,n.kt)("p",null,"Noteworthy:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The order of multi-valued fields is undefined."),(0,n.kt)("li",{parentName:"ul"},"It's possible to impose set semantics by using the ",(0,n.kt)("inlineCode",{parentName:"li"},"keyword")," type. Specifying\nthis type causes duplicate removal on ingest."),(0,n.kt)("li",{parentName:"ul"},"Other types, like ",(0,n.kt)("inlineCode",{parentName:"li"},"long"),", do not cause removal of duplicates on ingest.")),(0,n.kt)("p",null,"The output is still semi-structured in that listness is something dynamic on a\nper-value basis. Consider this output:"),(0,n.kt)("pre",null,(0,n.kt)("code",d({parentName:"pre"},{className:"language-json"}),'{\n  "columns": [\n    { "name": "a", "type": "long"},\n    { "name": "b", "type": "long"}\n  ],\n  "values": [\n    [1, [1, 2]],\n    [2,      3]\n  ]\n}\n')),(0,n.kt)("p",null,"The column ",(0,n.kt)("inlineCode",{parentName:"p"},"b")," has the list value ",(0,n.kt)("inlineCode",{parentName:"p"},"[1, 2]")," in the first row and ",(0,n.kt)("inlineCode",{parentName:"p"},"3")," in the\nsecond. In a strict type system (like TQL), the type of ",(0,n.kt)("inlineCode",{parentName:"p"},"b")," could be\n",(0,n.kt)("inlineCode",{parentName:"p"},"list<long>")," but then the second row would have value ",(0,n.kt)("inlineCode",{parentName:"p"},"[3]")," instead of ",(0,n.kt)("inlineCode",{parentName:"p"},"3"),". Sum\ntypes (called ",(0,n.kt)("inlineCode",{parentName:"p"},"union")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"variant")," in many languages) are another way to\nrepresent heterogeneous data as in the above example. If we described ",(0,n.kt)("inlineCode",{parentName:"p"},"b")," with\nthe type ",(0,n.kt)("inlineCode",{parentName:"p"},"union<long, list<long>>")," instead of ",(0,n.kt)("inlineCode",{parentName:"p"},"long"),", then it would be perfectly\nfine for ",(0,n.kt)("inlineCode",{parentName:"p"},"b")," to take one value ",(0,n.kt)("inlineCode",{parentName:"p"},"[1, 2]")," in one row and ",(0,n.kt)("inlineCode",{parentName:"p"},"3")," in another."),(0,n.kt)("p",null,"For TQL, we built our data model on top of data frames. We express structure in\nterms of ",(0,n.kt)("em",{parentName:"p"},"records")," and ",(0,n.kt)("em",{parentName:"p"},"lists"),", and arbitrarily nested combinations of them. It\nwould be up the user to define set semantics that ensures unique values. We\nconsider adding such a set type in the future (possible as type constraint or\nattribute) as we gain more complete support of the underlying Arrow type system.\nSimilarly, we plan on adding sum types in the future."),(0,n.kt)("h2",d({},{id:"summary"}),"Summary"),(0,n.kt)("p",null,"The release of ES|QL witnesses a current trend of convergence in terms of query\nlanguages. The pipeline concept now exists for several decades. Splunk was the\nfirst company to successfully commercialize this interface with SPL, but today\nthere are many players in the market that have a similar language. Microsoft\nopen-sourced their Kusto language, and we see other vendors embedding it into\ntheir products, such as Cribl Search. Most SIEM vendors also have their own\ninhouse pipeline language."),(0,n.kt)("p",null,"The data ecosystem has numerous languages for advanced users to offer, such as\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://dplyr.tidyverse.org/"}),"dplyr"),", ",(0,n.kt)("a",d({parentName:"p"},{href:"https://stedolan.github.io/jq/"}),"jq"),",\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://pandas.pydata.org/"}),"pandas"),", and ",(0,n.kt)("a",d({parentName:"p"},{href:"https://www.pola.rs/"}),"polars"),". And\nnew ones are mushrooming everywhere, e.g., ",(0,n.kt)("a",d({parentName:"p"},{href:"https://prql-lang.org/"}),"PRQL"),",\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://zed.brimdata.io/"}),"Zed"),"."),(0,n.kt)("p",null,"With our own TQL, we seek to bridge the data and security analytics world, by\noffering an intuitive language that is easy to grasp, but that internally maps\nto vectorized execution on top of data frames that can be easily shared with other\nruntimes."),(0,n.kt)("p",null,"If you want to look deeper at ES|QL, check out the branch\n",(0,n.kt)("a",d({parentName:"p"},{href:"https://github.com/elastic/elasticsearch/tree/feature/esql/x-pack/plugin/esql"}),(0,n.kt)("inlineCode",{parentName:"a"},"feature/esql")),". Find something interesting about pipelines to\ndiscuss? Swing by our ",(0,n.kt)("a",d({parentName:"p"},{href:"/discord"}),"Discord")," and start a conversation."),(0,n.kt)("div",d({},{className:"footnotes"}),(0,n.kt)("hr",{parentName:"div"}),(0,n.kt)("ol",{parentName:"div"},(0,n.kt)("li",d({parentName:"ol"},{id:"fn-1-7e9dca"}),"We took the name ",(0,n.kt)("inlineCode",{parentName:"li"},"extend")," from Kusto. In general, we find that Kusto has\nvery self-descriptive operator names. During the design of TQL, we compared\nmany different languages and often favored Kusto's choice of name.",(0,n.kt)("a",d({parentName:"li"},{href:"#fnref-1-7e9dca",className:"footnote-backref"}),"\u21a9")))))}N.isMDXComponent=!0}}]);