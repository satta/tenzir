"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[79156],{3905:(t,e,n)=>{n.d(e,{Zo:()=>d,kt:()=>g});var a=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var s=a.createContext({}),o=function(t){var e=a.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):l(l({},e),t)),n},d=function(t){var e=o(t.components);return a.createElement(s.Provider,{value:e},t.children)},h="mdxType",m={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},c=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,i=t.originalType,s=t.parentName,d=p(t,["components","mdxType","originalType","parentName"]),h=o(n),c=r,g=h["".concat(s,".").concat(c)]||h[c]||m[c]||i;return n?a.createElement(g,l(l({ref:e},d),{},{components:n})):a.createElement(g,l({ref:e},d))}));function g(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=n.length,l=new Array(i);l[0]=c;var p={};for(var s in e)hasOwnProperty.call(e,s)&&(p[s]=e[s]);p.originalType=t,p[h]="string"==typeof t?t:r,l[1]=p;for(var o=2;o<i;o++)l[o]=n[o];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},67412:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>y,contentTitle:()=>f,default:()=>N,frontMatter:()=>g,metadata:()=>u,toc:()=>k});var a=n(3905),r=Object.defineProperty,i=Object.defineProperties,l=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(t,e,n)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,h=(t,e)=>{for(var n in e||(e={}))s.call(e,n)&&d(t,n,e[n]);if(p)for(var n of p(e))o.call(e,n)&&d(t,n,e[n]);return t},m=(t,e)=>i(t,l(e)),c=(t,e)=>{var n={};for(var a in t)s.call(t,a)&&e.indexOf(a)<0&&(n[a]=t[a]);if(null!=t&&p)for(var a of p(t))e.indexOf(a)<0&&o.call(t,a)&&(n[a]=t[a]);return n};const g={title:"Switching Fluent Bit from JSON to MsgPack",authors:["mavam"],date:new Date("2024-01-10T00:00:00.000Z"),tags:["fluent-bit","json","msgpack","performance"],comments:!0},f=void 0,u={permalink:"/blog/switching-fluentbit-from-json-to-msgpack",source:"@site/blog/switching-fluentbit-from-json-to-msgpack/index.md",title:"Switching Fluent Bit from JSON to MsgPack",description:"We re-wired Tenzir's fluent-bit operator and",date:"2024-01-10T00:00:00.000Z",formattedDate:"January 10, 2024",tags:[{label:"fluent-bit",permalink:"/blog/tags/fluent-bit"},{label:"json",permalink:"/blog/tags/json"},{label:"msgpack",permalink:"/blog/tags/msgpack"},{label:"performance",permalink:"/blog/tags/performance"}],readingTime:2.54,hasTruncateMarker:!0,authors:[{name:"Matthias Vallentin",title:"Founder & CEO",url:"https://github.com/mavam",email:"matthias@tenzir.com",imageURL:"https://github.com/mavam.png",key:"mavam"}],frontMatter:{title:"Switching Fluent Bit from JSON to MsgPack",authors:["mavam"],date:"2024-01-10T00:00:00.000Z",tags:["fluent-bit","json","msgpack","performance"],comments:!0},prevItem:{title:"Tenzir v4.8",permalink:"/blog/tenzir-v4.8"},nextItem:{title:"Tenzir v4.7",permalink:"/blog/tenzir-v4.7"}},y={authorsImageUrls:[void 0]},k=[{value:"The Issue",id:"the-issue",level:2},{value:"Evaluation",id:"evaluation",level:2},{value:"Summary",id:"summary",level:2}],x={toc:k},M="wrapper";function N(t){var e=t,{components:n}=e,r=c(e,["components"]);return(0,a.kt)(M,m(h(h({},x),r),{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"We re-wired Tenzir's ",(0,a.kt)("a",h({parentName:"p"},{href:"/operators/fluent-bit"}),(0,a.kt)("inlineCode",{parentName:"a"},"fluent-bit"))," operator and\nintroduced a significant performance boost as a side effect: A 3\u20135x gain for\nthroughput in events per second (EPS) and 4\u20138x improvement of latency in terms\nof processing time."),(0,a.kt)("p",null,(0,a.kt)("figure",h({parentName:"p"},{className:"markdown-inline-svg"}),"\n  ",(0,a.kt)("svg",h({parentName:"figure"},{className:"svglite",viewBox:"0 0 1152 648",role:"img","aria-hidden":"true"}),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("style",{parentName:"defs"},".svglite polyline,.svglite rect{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10}.svglite text{white-space:pre}")),(0,a.kt)("rect",h({parentName:"svg"},{width:"100%",height:"100%",style:{stroke:"none",fill:"none"}})),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpMC4wMHwxMTUyLjAwfDAuMDB8NjQ4LjAw"}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M0 0h1152v648H0z"})))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpMTMuOTV8NTc2LjAwfDEzLjk1fDYzNC4wNQ=="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M13.95 13.95H576v620.1H13.95z"})))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpODYuMTV8NTYyLjA1fDI3LjkwfDU1My4zMA=="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M86.15 27.9h475.9v525.41H86.15z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpODYuMTV8NTYyLjA1fDI3LjkwfDU1My4zMA==)"}),(0,a.kt)("path",h({parentName:"g"},{d:"M86.15 445.56h475.9M86.15 277.84h475.9M86.15 110.12h475.9",style:{strokeWidth:"1.36",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M86.15 529.42h475.9M86.15 361.7h475.9M86.15 193.98h475.9M215.94 553.3V27.9M432.26 553.3V27.9",style:{strokeWidth:"2.72",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M334.92 263.55h194.69v265.87H334.92zM118.6 51.78h194.69v477.64H118.6z",style:{strokeWidth:"1.07",stroke:"none",strokeLinecap:"butt",strokeLinejoin:"miter",fill:"#0086e5"}}))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpMC4wMHwxMTUyLjAwfDAuMDB8NjQ4LjAw)"}),(0,a.kt)("text",h({parentName:"g"},{x:"73.6",y:"537.45",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"0"),(0,a.kt)("text",h({parentName:"g"},{x:"73.6",y:"369.73",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"2"),(0,a.kt)("text",h({parentName:"g"},{x:"73.6",y:"202.01",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"4"),(0,a.kt)("text",h({parentName:"g"},{x:"215.94",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"53.54"}),"Linux"),(0,a.kt)("text",h({parentName:"g"},{x:"432.26",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"74.66"}),"macOS"),(0,a.kt)("text",h({parentName:"g"},{x:"324.1",y:"613.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"28px",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"322.14"}),"Events Per Second (EPS)"),(0,a.kt)("text",h({parentName:"g"},{lengthAdjust:"spacingAndGlyphs",style:{fontSize:"28px",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"112.12",transform:"rotate(-90 169.29 121.31)"}),"Speedup")),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpNTc2LjAwfDExMzguMDV8MTMuOTV8NjM0LjA1"}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M576 13.95h562.05v620.1H576z"})))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpNjQ4LjIwfDExMjQuMTB8MjcuOTB8NTUzLjMw"}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M648.2 27.9h475.9v525.41H648.2z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpNjQ4LjIwfDExMjQuMTB8MjcuOTB8NTUzLjMw)"}),(0,a.kt)("path",h({parentName:"g"},{d:"M648.2 471.16h475.9M648.2 354.65h475.9M648.2 238.13h475.9M648.2 121.61h475.9",style:{strokeWidth:"1.36",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M648.2 529.42h475.9M648.2 412.9h475.9M648.2 296.39h475.9M648.2 179.87h475.9M648.2 63.36h475.9M777.99 553.3V27.9M994.31 553.3V27.9",style:{strokeWidth:"2.72",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M896.97 277.19h194.69v252.23H896.97zM680.65 51.78h194.69v477.64H680.65z",style:{strokeWidth:"1.07",stroke:"none",strokeLinecap:"butt",strokeLinejoin:"miter",fill:"#a102c8"}}))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpMC4wMHwxMTUyLjAwfDAuMDB8NjQ4LjAw)"}),(0,a.kt)("text",h({parentName:"g"},{x:"635.65",y:"537.45",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"0"),(0,a.kt)("text",h({parentName:"g"},{x:"635.65",y:"420.93",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"2"),(0,a.kt)("text",h({parentName:"g"},{x:"635.65",y:"304.42",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"4"),(0,a.kt)("text",h({parentName:"g"},{x:"635.65",y:"187.9",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"6"),(0,a.kt)("text",h({parentName:"g"},{x:"635.65",y:"71.38",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"8"),(0,a.kt)("text",h({parentName:"g"},{x:"777.99",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"53.54"}),"Linux"),(0,a.kt)("text",h({parentName:"g"},{x:"994.31",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"74.66"}),"macOS"),(0,a.kt)("text",h({parentName:"g"},{x:"886.15",y:"613.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"28px",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"104.26"}),"Runtime"),(0,a.kt)("text",h({parentName:"g"},{lengthAdjust:"spacingAndGlyphs",style:{fontSize:"28px",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"112.12",transform:"rotate(-90 450.315 -159.715)"}),"Speedup"))))),(0,a.kt)("p",null,"Why were these gains available? Because we eliminated one round-trip of internal\nJSON printing and parsing."),(0,a.kt)("h2",h({},{id:"the-issue"}),"The Issue"),(0,a.kt)("p",null,"Our primary goal was actually working around an issue\nwith the Fluent Bit ",(0,a.kt)("inlineCode",{parentName:"p"},"lib")," output plugin, which we use whenever we have a\n",(0,a.kt)("inlineCode",{parentName:"p"},"fluent-bit")," source operator. For example, if you configure an ",(0,a.kt)("inlineCode",{parentName:"p"},"elasticsearch"),"\nFluent Bit source, Tenzir's ",(0,a.kt)("inlineCode",{parentName:"p"},"fluent-bit")," operator autocomplete the ",(0,a.kt)("inlineCode",{parentName:"p"},"lib")," output\nplugin. This plugin has two modes of accepting input: JSON or\n",(0,a.kt)("a",h({parentName:"p"},{href:"https://msgpack.org/"}),"MsgPack"),"."),(0,a.kt)("p",null,"Up to now, we relied on the JSON transfer mode because it was faster to get\nstarted. However, during testing with the ",(0,a.kt)("inlineCode",{parentName:"p"},"elasticsearch")," input that receives\nlarge Windows event logs via Winlogbeat, we noticed that Fluent Bit's ",(0,a.kt)("inlineCode",{parentName:"p"},"lib"),"\noutput produces messages of the form ",(0,a.kt)("inlineCode",{parentName:"p"},"[timestamp, object]")," where ",(0,a.kt)("inlineCode",{parentName:"p"},"object")," was\ncropped. This basically generated invalid JSON."),(0,a.kt)("p",null,"The fix involved switching the exchange format of the ",(0,a.kt)("inlineCode",{parentName:"p"},"lib")," output plugin from\nJSON to MsgPack. If you're curious, take a look at\n",(0,a.kt)("a",h({parentName:"p"},{href:"https://github.com/tenzir/tenzir/pull/3770"}),"#3770")," for the full scoop. The\nimprovement is already in the current development version and will be available\nwith the next release."),(0,a.kt)("h2",h({},{id:"evaluation"}),"Evaluation"),(0,a.kt)("p",null,"We were curious how much this removal of the extra layer of printing and parsing\nactually buys us. To this end, we use the following pipeline:"),(0,a.kt)("pre",null,(0,a.kt)("code",h({parentName:"pre"},{className:"language-bash"}),"tenzir --dump-metrics 'fluent-bit stdin | head 10M | discard' < eve.json\n")),(0,a.kt)("p",null,"Adding ",(0,a.kt)("inlineCode",{parentName:"p"},"--dump-metrics")," adds detailed per-operator metrics that help us\nunderstand where operators spend their time. The ",(0,a.kt)("a",h({parentName:"p"},{href:"/operators/head"}),(0,a.kt)("inlineCode",{parentName:"a"},"head")),"\noperator take the first 10 million events, and ",(0,a.kt)("a",h({parentName:"p"},{href:"/operators/discard"}),(0,a.kt)("inlineCode",{parentName:"a"},"discard")),"\nsimply drops its input. The ",(0,a.kt)("inlineCode",{parentName:"p"},"eve.json")," input into the ",(0,a.kt)("inlineCode",{parentName:"p"},"tenzir")," binary is from\nour Suricata dataset that we use in the ",(0,a.kt)("a",h({parentName:"p"},{href:"/user-guides"}),"user guides"),". We measured\nran our measurements on a 2021 Apple MacBook Pro M1 Max, as well as on a Manjaro\nLinux laptop with a 14-core Intel i7 CPU."),(0,a.kt)("p",null,"Our intuition was that we won't see major improvements, because generating JSON\nisn't that expensive and we use ",(0,a.kt)("a",h({parentName:"p"},{href:"https://simdjson.org/"}),"simdjson")," to parse JSON.\nBut the results surprised us:"),(0,a.kt)("p",null,(0,a.kt)("figure",h({parentName:"p"},{className:"markdown-inline-svg"}),"\n  ",(0,a.kt)("svg",h({parentName:"figure"},{className:"svglite",viewBox:"0 0 1152 648",role:"img","aria-hidden":"true"}),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("style",{parentName:"defs"},".svglite polyline,.svglite rect{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10}.svglite text{white-space:pre}")),(0,a.kt)("rect",h({parentName:"svg"},{width:"100%",height:"100%",style:{stroke:"none",fill:"none"}})),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpMC4wMHwxMTUyLjAwfDAuMDB8NjQ4LjAw"}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M0 0h1152v648H0z"})))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpMTMuOTV8NTg5LjY5fDEzLjk1fDYzNC4wNQ=="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M13.95 13.95H589.7v620.1H13.95z"})))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpMTI2LjAwfDM0My45MHw3MS4yMXw1NTMuMzA="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M126 71.21h217.9V553.3H126z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpMTI2LjAwfDM0My45MHw3MS4yMXw1NTMuMzA=)"}),(0,a.kt)("path",h({parentName:"g"},{d:"M126 462.6h217.9M126 325.01h217.9M126 187.43h217.9",style:{strokeWidth:"1.36",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M126 531.39h217.9M126 393.8h217.9M126 256.22h217.9M126 118.63h217.9M185.42 553.3V71.21M284.47 553.3V71.21",style:{strokeWidth:"2.72",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M140.85 468.05h89.14v63.34h-89.14zM239.9 170.6h89.14v360.79H239.9z",style:{strokeWidth:"1.07",stroke:"none",strokeLinecap:"butt",strokeLinejoin:"miter",fill:"#0086e5"}}))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpMzU3Ljg1fDU3NS43NXw3MS4yMXw1NTMuMzA="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M357.85 71.21h217.9V553.3h-217.9z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpMzU3Ljg1fDU3NS43NXw3MS4yMXw1NTMuMzA=)"}),(0,a.kt)("path",h({parentName:"g"},{d:"M357.85 462.6h217.9M357.85 325.01h217.9M357.85 187.43h217.9",style:{strokeWidth:"1.36",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M357.85 531.39h217.9M357.85 393.8h217.9M357.85 256.22h217.9M357.85 118.63h217.9M417.27 553.3V71.21M516.32 553.3V71.21",style:{strokeWidth:"2.72",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M372.7 393.15h89.14v138.24H372.7zM471.75 93.13h89.14v438.26h-89.14z",style:{strokeWidth:"1.07",stroke:"none",strokeLinecap:"butt",strokeLinejoin:"miter",fill:"#0086e5"}}))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpMTI2LjAwfDM0My45MHwyNy45MHw3MS4yMQ=="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M126 27.9h217.9v43.32H126z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpMTI2LjAwfDM0My45MHwyNy45MHw3MS4yMQ==)"}),(0,a.kt)("text",h({parentName:"g"},{x:"234.95",y:"57.58",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#1a1a1a",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"53.54"}),"Linux")),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpMzU3Ljg1fDU3NS43NXwyNy45MHw3MS4yMQ=="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M357.85 27.9h217.9v43.32h-217.9z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpMzU3Ljg1fDU3NS43NXwyNy45MHw3MS4yMQ==)"}),(0,a.kt)("text",h({parentName:"g"},{x:"466.8",y:"57.58",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#1a1a1a",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"74.66"}),"macOS")),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpMC4wMHwxMTUyLjAwfDAuMDB8NjQ4LjAw)"}),(0,a.kt)("text",h({parentName:"g"},{x:"185.42",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"42.33"}),"v4.7"),(0,a.kt)("text",h({parentName:"g"},{x:"284.47",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"42.33"}),"v4.8"),(0,a.kt)("text",h({parentName:"g"},{x:"417.27",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"42.33"}),"v4.7"),(0,a.kt)("text",h({parentName:"g"},{x:"516.32",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"42.33"}),"v4.8"),(0,a.kt)("text",h({parentName:"g"},{x:"113.44",y:"539.42",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"0"),(0,a.kt)("text",h({parentName:"g"},{x:"113.44",y:"401.83",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"39.84"}),"50K"),(0,a.kt)("text",h({parentName:"g"},{x:"113.44",y:"264.25",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"52.3"}),"100K"),(0,a.kt)("text",h({parentName:"g"},{x:"113.44",y:"126.66",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"52.3"}),"150K"),(0,a.kt)("text",h({parentName:"g"},{x:"350.87",y:"613.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"28px",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"180.5"}),"Tenzir Version"),(0,a.kt)("text",h({parentName:"g"},{lengthAdjust:"spacingAndGlyphs",style:{fontSize:"28px",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"322.14",transform:"rotate(-90 180.12 132.14)"}),"Events Per Second (EPS)")),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpNTg5LjY5fDExMzguMDV8MTMuOTV8NjM0LjA1"}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M589.69 13.95h548.36v620.1H589.69z"})))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpNjc0LjM1fDg5Mi4yNnw3MS4yMXw1NTMuMzA="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M674.35 71.21h217.9V553.3h-217.9z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpNjc0LjM1fDg5Mi4yNnw3MS4yMXw1NTMuMzA=)"}),(0,a.kt)("path",h({parentName:"g"},{d:"M674.35 480.06h217.91M674.35 377.4h217.91M674.35 274.74h217.91M674.35 172.07h217.91",style:{strokeWidth:"1.36",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M674.35 531.39h217.91M674.35 428.73h217.91M674.35 326.07h217.91M674.35 223.4h217.91M674.35 120.74h217.91M733.78 553.3V71.21M832.83 553.3V71.21",style:{strokeWidth:"2.72",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M689.21 129.06h89.14v402.33h-89.14zM788.26 482.32h89.14v49.07h-89.14z",style:{strokeWidth:"1.07",stroke:"none",strokeLinecap:"butt",strokeLinejoin:"miter",fill:"#a102c8"}}))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpOTA2LjIwfDExMjQuMTB8NzEuMjF8NTUzLjMw"}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M906.2 71.21h217.9V553.3H906.2z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpOTA2LjIwfDExMjQuMTB8NzEuMjF8NTUzLjMw)"}),(0,a.kt)("path",h({parentName:"g"},{d:"M906.2 480.06h217.9M906.2 377.4h217.9M906.2 274.74h217.9M906.2 172.07h217.9",style:{strokeWidth:"1.36",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M906.2 531.39h217.9M906.2 428.73h217.9M906.2 326.07h217.9M906.2 223.4h217.9M906.2 120.74h217.9M965.63 553.3V71.21M1064.68 553.3V71.21",style:{strokeWidth:"2.72",stroke:"#ebebeb",strokeLinecap:"butt"}})),(0,a.kt)("path",h({parentName:"g"},{d:"M921.06 93.13h89.14v438.26h-89.14zM1020.11 430.17h89.14v101.22h-89.14z",style:{strokeWidth:"1.07",stroke:"none",strokeLinecap:"butt",strokeLinejoin:"miter",fill:"#a102c8"}}))),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpNjc0LjM1fDg5Mi4yNnwyNy45MHw3MS4yMQ=="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M674.35 27.9h217.9v43.32h-217.9z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpNjc0LjM1fDg5Mi4yNnwyNy45MHw3MS4yMQ==)"}),(0,a.kt)("text",h({parentName:"g"},{x:"783.3",y:"57.58",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#1a1a1a",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"53.54"}),"Linux")),(0,a.kt)("defs",{parentName:"svg"},(0,a.kt)("clipPath",h({parentName:"defs"},{id:"cpOTA2LjIwfDExMjQuMTB8MjcuOTB8NzEuMjE="}),(0,a.kt)("path",h({parentName:"clipPath"},{d:"M906.2 27.9h217.9v43.32H906.2z"})))),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpOTA2LjIwfDExMjQuMTB8MjcuOTB8NzEuMjE=)"}),(0,a.kt)("text",h({parentName:"g"},{x:"1015.15",y:"57.58",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#1a1a1a",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"74.66"}),"macOS")),(0,a.kt)("g",h({parentName:"svg"},{clipPath:"url(#cpMC4wMHwxMTUyLjAwfDAuMDB8NjQ4LjAw)"}),(0,a.kt)("text",h({parentName:"g"},{x:"733.78",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"42.33"}),"v4.7"),(0,a.kt)("text",h({parentName:"g"},{x:"832.83",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"42.33"}),"v4.8"),(0,a.kt)("text",h({parentName:"g"},{x:"965.63",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"42.33"}),"v4.7"),(0,a.kt)("text",h({parentName:"g"},{x:"1064.68",y:"581.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"42.33"}),"v4.8"),(0,a.kt)("text",h({parentName:"g"},{x:"661.8",y:"539.42",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"12.46"}),"0"),(0,a.kt)("text",h({parentName:"g"},{x:"661.8",y:"436.76",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"24.91"}),"10"),(0,a.kt)("text",h({parentName:"g"},{x:"661.8",y:"334.09",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"24.91"}),"20"),(0,a.kt)("text",h({parentName:"g"},{x:"661.8",y:"231.43",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"24.91"}),"30"),(0,a.kt)("text",h({parentName:"g"},{x:"661.8",y:"128.77",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"22.4px",fill:"#4d4d4d",fontFamily:'"Arial"'},textAnchor:"end",textLength:"24.91"}),"40"),(0,a.kt)("text",h({parentName:"g"},{x:"899.23",y:"613.91",lengthAdjust:"spacingAndGlyphs",style:{fontSize:"28px",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"180.5"}),"Tenzir Version"),(0,a.kt)("text",h({parentName:"g"},{lengthAdjust:"spacingAndGlyphs",style:{fontSize:"28px",fontFamily:'"Arial"'},textAnchor:"middle",textLength:"234.96",transform:"rotate(-90 467.99 -155.73)"}),"Runtime (seconds)"))))),(0,a.kt)("p",null,"On macOS, events per second tripled from 50k to 150k, and the pipeline runtime\nwent from 42 to 10 seconds. On Linux, the improvements were even higher. We\ndon't have a good explanation for the rather stark difference between the\noperating systems. Our hunch is that the allocator performance is the high-order\nbit explaining the difference."),(0,a.kt)("h2",h({},{id:"summary"}),"Summary"),(0,a.kt)("p",null,"We switched from JSON to MsgPack for our ",(0,a.kt)("a",h({parentName:"p"},{href:"/operators/fluent-bit"}),(0,a.kt)("inlineCode",{parentName:"a"},"fluent-bit")),"\nsource operator. This removed one round-trip of printing JSON (in Fluent Bit)\nand parsing JSON (in Tenzir). We were surprised to see that this change resulted\nin such substantial performance improvements. As a result, you can now run many\nmore Fluent Bit ingestion pipelines in parallel at a single node with the same\nresources, or vertically scale your Fluent Bit pipeline to new limits."),(0,a.kt)("admonition",h({},{title:"Acknowledgements",type:"tip"}),(0,a.kt)("p",{parentName:"admonition"},"Thanks to Christoph Lobmeyer and Yannik Meinhardt for reporting this issue! \ud83d\ude4f")))}N.isMDXComponent=!0}}]);